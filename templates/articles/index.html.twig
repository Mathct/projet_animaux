{% extends 'base.html.twig' %}

{% block title %}Articles index{% endblock %}

{% block body %}
    <h1>Articles sur les animaux</h1>

    <div><a href="{{ path('app_articles_new') }}"><button>Créer un article</button></a></div>

        {% for article in articles %}

                <h2>{{ article.title }}</h2>
                <div>Date de création: {{ article.createdAt ? article.createdAt|date('Y-m-d H:i:s') : '' }}</div>
                <div><span>Nombre de commentaires: {{ article.commentaires|length }} </span> 
                <span>Note: 
                    {% if article.commentaires|length > 0 %}
                    {% set total = article.commentaires|map(c => c.notation)|reduce((carry, v) => carry + v) %}
                    {% set moyenne = (total / article.commentaires|length)|round(1) %}
                    {{ moyenne|number_format(moyenne is same as(moyenne|round(0)) ? 0 : 1) }}/5
                    {% else %}
                        -
                    {% endif %}
                </span>
                </div>
              
                    <div><a href="{{ path('app_articles_show', {'id': article.id}) }}"><button>Lire l'article</button></a>
                
                <br><br>
        {% else %}
        <div>Aucun article créé</div>
        {% endfor %}

    
{% endblock %}
